# TestECPlatformWebAPI(GOF生成パターンを制覇しよう)

## はじめに
OpenAPI(RESTfulAPI)の基盤部構築における工夫をまとめた技術資料で複数のECサイトが連携するプラットフォームを例としています。 ※ ビジネスロジックはありません

GOFの生成パターンを全て使用してみたいと思い、各生成過程で拡張性、再利用性、一貫性等様々な特性が求められる、API基盤部の複雑なオブジェクト（本ソリューションではAccesorsと呼ぶ）生成に適用しています。

以下ではAccesors生成を中心に解説していますが、ソース中には他にもGOFを適用している箇所やそれ以外にもオリジナルのステータスコードの返し方や各種共通関数も多数作成していますのでよろしければ併せましてご確認ください。

### Accesorの役割
- getCode：本アクセサの対象ECサイトのコードを取得します（APIサーバーの場合は空文字）
- getConnectionString：ECサイト毎のDB接続文字列を取得します
- getAppsettings：Appsettings.json(.netCoreのコンフィグ)へのアクセサオブジェクトを取得します
- getConnection：今回はOracleConnectionを想定してDBコネクションオブジェクトを取得します
- getLoggerAPI：APIサーバーのログテーブルへ書き込みを行うオブジェクトを取得します
- getLoggerClient：ECサイト毎のログテーブルへ書き込みを行うオブジェクトを取得します
- getLockObject：ECサイト毎の購入時のロックオブジェクトを取得します。

## 全体のソースコード
ソリューション（C#のプロジェクト群）として公開しております
Source\TestECPlatformWebAPI

## 技術資料
上記ソースの工夫点を以下のリンクから生成パターンごとに解説していきます。

本プロジェクトでは、少し複雑になりますがFactoryパターンを入れ子構造に展開し、クライアントサイトが自社サイトの購入処理を行うか他社サイトの購入処理を行うかによって適切なオブジェクト群を一括生成できるようにプログラムしました。

### GOFのCreational Patterns（生成パターン）
1. Builderパターン：AccessorのBuild部を効率化しています
1. Factoryパターン.AbstractFactoryパターン：Accesors関連のオブジェクト群生成、具体的な生成ロジックをクライアントから分離しています
1. Factoryパターン.FactoryMethodパターン：Accesors関連オブジェクト群生成、メソッド単位で抽象化し多態性を持たせるようにしています
1. Factoryパターン.Singletonパターン：ロックオブジェクト生成・取得に一意性を担保することでグローバルアクセスポイントとしています
1. Factoryパターン.Prototypeパターン：

### GOF以外の生成パターン
1. Factoryパターン.SimpleFactoryパターン：最終的な購入処理クラスインスタンス化ロジックを一箇所に集めカプセル化します

※ Factoryパターンとは
オブジェクト生成を抽象化する方法全般を指します。オブジェクトの生成をカプセル化するデザインパターンの一種で、具体的な生成方法をクライアントコードから分離する事ができます。

## 命名規則・C#補足
- internalはJavaでいうpackage-privateと同義です
- 主なプリフィックスは以下の通りです
    - I：Interface
    - i: in(引数)
    - w: work(ローカル変数)
    - r: ref(in out型)

## 参考文献
- Java言語で学ぶデザインパターン入門第3版 Kindle版 結城 浩


